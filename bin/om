#!/bin/sh

# variables users can override in the defaults file
OSVC_ROOT_PATH="/usr/share/opensvc"
OSVC_PYTHON="python"
OSVC_PYTHON_ARGS=""

if [ -r "/etc/defaults/opensvc" ]
then
	# FreeBSD, Darwin
	. "/etc/defaults/opensvc"
elif [ -r "/etc/default/opensvc" ]
then
	# Debian-like, Tru64, SunOS and HP-UX
	. "/etc/default/opensvc"
elif [ -r "/etc/sysconfig/opensvc" ]
then
	# Red Hat-like
	. "/etc/sysconfig/opensvc"
elif [ -r "/etc/conf.d/opensvc" ]
then
	# Alpine, Gentoo
	. "/etc/conf.d/opensvc"
elif [ -r "/etc/rc.config.d/opensvc" ]
then
	# AIX
	. "/etc/rc.config.d/opensvc"
fi

INTER="$OSVC_PYTHON $OSVC_PYTHON_ARGS"

main() {
	if test -z "$OSVC_CONTEXT"
	then
		case "`id`" in
		uid=0\(*)
			;;
		*)
			SUDO=`which sudo 2>/dev/null`
			;;
		esac
	fi
	test -z "$SUDO" && SUDO=env || SUDO="$SUDO OSVC_NAMESPACE=$OSVC_NAMESPACE"
	case $1 in
	ns)
		echo "The 'om' alias must be sourced to handle ns actions" >&2
		exit 1
		;;
	*)
		$SUDO PYTHONPATH=$OSVC_ROOT_PATH $INTER -m opensvc "$@"
		;;
	esac
}

main "$@"
